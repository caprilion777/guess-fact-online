<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£–≥–∞–¥–∞–π —Ñ–∞–∫—Ç - –û–Ω–ª–∞–π–Ω</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    body { 
      font-family: 'Inter', 'Segoe UI', 'Roboto', Arial, sans-serif; 
      background: repeating-linear-gradient(135deg, #f8fafc, #f3f4f6 40px, #f8fafc 80px); 
      margin: 0; padding: 0; 
    }
    .container { 
      max-width: 600px; 
      margin: 40px auto; 
      background: #fff; 
      border-radius: 18px; 
      box-shadow: 0 4px 32px #0001; 
      padding: 32px 20px 28px 20px; 
      border: 2.5px solid #e5e7eb; 
    }
    h2 { 
      margin-top: 0; 
      letter-spacing: 0.01em; 
      color: #222; 
      font-weight: 700; 
      font-family: inherit; 
      text-shadow: none; 
    }
    .hidden { display: none; }
    .center { text-align: center; }
    .step { margin-bottom: 24px; }
    
    /* –ö–Ω–æ–ø–∫–∏ */
    button { 
      background: #fff; 
      color: #222; 
      border: 2.5px solid #6366f1; 
      border-radius: 12px; 
      padding: 12px 24px; 
      cursor: pointer; 
      font-size: 1.08rem; 
      box-shadow: 0 2px 8px #6366f122; 
      font-weight: 600; 
      letter-spacing: 0.01em; 
      transition: background 0.15s, box-shadow 0.15s, border 0.15s, color 0.15s; 
      margin: 8px;
    }
    button:disabled { 
      background: #e5e7eb; 
      color: #b0b3b8; 
      border: 2.5px dashed #e5e7eb; 
      cursor: not-allowed; 
    }
    button:hover:not(:disabled) { 
      background: #f3f4f6; 
      color: #6366f1; 
      border-color: #6366f1; 
    }
    .primary-btn { 
      background: #6366f1; 
      color: #fff; 
    }
    .primary-btn:hover:not(:disabled) { 
      background: #4f46e5; 
      color: #fff; 
    }
    
    /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
    input, select { 
      border-radius: 8px; 
      border: 1.5px solid #e5e7eb; 
      padding: 12px 16px; 
      font-size: 1.08em; 
      background: #f8fafc; 
      transition: border 0.15s; 
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 16px;
    }
    input:focus, select:focus { 
      border: 1.5px solid #6366f1; 
      outline: none; 
    }
    
    /* –õ–æ–±–±–∏ */
    .room-code { 
      background: #f3f4f6; 
      padding: 16px; 
      border-radius: 12px; 
      font-size: 1.2em; 
      font-weight: 700; 
      color: #6366f1; 
      text-align: center; 
      margin: 16px 0; 
      border: 2px solid #e5e7eb;
    }
    .player-item { 
      display: flex; 
      align-items: center; 
      background: #f8fafc; 
      border-radius: 12px; 
      padding: 12px 16px; 
      margin: 8px 0; 
      border: 1.5px solid #e5e7eb; 
    }
    .host-badge { 
      background: #fbbf24; 
      color: #92400e; 
      padding: 4px 8px; 
      border-radius: 6px; 
      font-size: 0.8em; 
      font-weight: 600; 
      margin-left: 8px; 
    }
    
    /* –ê–≤–∞—Ç–∞—Ä—ã */
    .avatar { 
      display: inline-flex; 
      align-items: center; 
      justify-content: center; 
      width: 40px; 
      height: 40px; 
      border-radius: 50%; 
      font-weight: 700; 
      font-size: 1.2em; 
      margin-right: 12px; 
      box-shadow: 0 1.5px 6px #0001; 
      border: 2px solid #e5e7eb; 
      background: #f3f4f6; 
      color: #222; 
    }
    .avatar-choice { 
      display: inline-block; 
      margin: 0 8px 8px 0; 
      cursor: pointer; 
      transition: transform 0.12s; 
      border: 2px solid #e5e7eb; 
      border-radius: 50%; 
      background: #f3f4f6; 
    }
    .avatar-choice.selected, .avatar-choice:hover { 
      border: 2px solid #6366f1; 
      box-shadow: 0 0 0 3px #a5b4fc; 
      transform: scale(1.08); 
    }
    .avatar-choice .avatar { margin: 0; }
    
    /* –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å */
    .fact-display { 
      background: #f8fafc; 
      padding: 20px; 
      border-radius: 12px; 
      font-size: 1.2em; 
      text-align: center; 
      margin: 20px 0; 
      border: 2px solid #e5e7eb; 
    }
    .guess-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
      gap: 12px; 
      margin: 20px 0; 
    }
    .guess-btn { 
      padding: 16px 12px; 
      font-size: 1em; 
      text-align: center; 
    }
    .guess-btn.selected { 
      background: #10b981; 
      color: #fff; 
      border-color: #10b981; 
    }
    
    /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
    .results-table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 16px; 
      border-radius: 12px; 
      overflow: hidden; 
      box-shadow: 0 2px 8px #0001; 
    }
    .results-table th, .results-table td { 
      border: 1.5px solid #e5e7eb; 
      padding: 12px; 
      text-align: center; 
      font-size: 1em; 
      background: #fff; 
    }
    .results-table th { 
      background: #f3f4f6; 
      color: #222; 
      font-weight: 700; 
    }
    .correct { background: #d1fae5; }
    .wrong { background: #fee2e2; }
    
    /* –°—Ç–∞—Ç—É—Å */
    .status { 
      background: #e0f2fe; 
      color: #0369a1; 
      padding: 12px; 
      border-radius: 8px; 
      margin: 16px 0; 
      text-align: center; 
      font-weight: 600; 
    }
    
    @media (max-width: 600px) {
      .container { padding: 16px; margin: 20px; }
      .guess-grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- –≠—Ç–∞–ø 1: –í—Ö–æ–¥ –≤ –∏–≥—Ä—É -->
    <div id="step-join" class="step">
      <h2>–£–≥–∞–¥–∞–π —Ñ–∞–∫—Ç - –û–Ω–ª–∞–π–Ω</h2>
      <div class="center">
        <button id="create-game-btn" class="primary-btn">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É</button>
        <button id="join-game-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ</button>
      </div>
    </div>

    <!-- –≠—Ç–∞–ø 1.5: –í–≤–æ–¥ –∏–º–µ–Ω–∏ -->
    <div id="step-name" class="step hidden">
      <h2 id="name-title">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è</h2>
      <input type="text" id="player-name" placeholder="–í–∞—à–µ –∏–º—è" maxlength="20">
      
      <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä:</h3>
      <div id="avatar-choices" class="center"></div>
      
      <div class="center">
        <button id="confirm-name-btn" class="primary-btn" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
    </div>

    <!-- –≠—Ç–∞–ø 2: –õ–æ–±–±–∏ -->
    <div id="step-lobby" class="step hidden">
      <h2>–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤</h2>
      <div class="room-code">
        –ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã: <span id="room-code-display"></span>
      </div>
      <div class="status" id="lobby-status">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</div>
      
      <h3>–ò–≥—Ä–æ–∫–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ:</h3>
      <div id="players-list"></div>
      
      <div class="center">
        <button id="start-game-btn" class="primary-btn" disabled>–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        <button id="copy-link-btn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
      </div>
    </div>

    <!-- –≠—Ç–∞–ø 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–µ–¥—É—â–µ–≥–æ) -->
    <div id="step-setup" class="step hidden">
      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã</h2>
      <div class="status">–í—ã - –≤–µ–¥—É—â–∏–π. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–≥—Ä—É –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤.</div>
      
      <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É:</label>
      <select id="theme-select">
        <option value="" disabled selected>‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É ‚Äî</option>
        <option>–î–µ—Ç—Å—Ç–≤–æ</option>
        <option>–°–∫—Ä—ã—Ç—ã–µ —Ç–∞–ª–∞–Ω—Ç—ã</option>
        <option>–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</option>
        <option>–°—Ç—Ä–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</option>
        <option>–ú–æ–∏ —Å–µ–∫—Ä–µ—Ç—ã</option>
      </select>
      
      <div id="facts-container">
        <h3>–§–∞–∫—Ç—ã –¥–ª—è —É–≥–∞–¥—ã–≤–∞–Ω–∏—è:</h3>
        <div id="facts-list"></div>
        <button id="add-fact-btn">+ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–∫—Ç</button>
      </div>
      
      <div class="center">
        <button id="start-round-btn" class="primary-btn" disabled>–ù–∞—á–∞—Ç—å —Ä–∞—É–Ω–¥</button>
      </div>
    </div>

    <!-- –≠—Ç–∞–ø 4: –û–∂–∏–¥–∞–Ω–∏–µ –≤–µ–¥—É—â–µ–≥–æ -->
    <div id="step-waiting" class="step hidden">
      <h2>–û–∂–∏–¥–∞–Ω–∏–µ –≤–µ–¥—É—â–µ–≥–æ</h2>
      <div class="status">–í–µ–¥—É—â–∏–π –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∏–≥—Ä—É...</div>
      <div class="center">
        <div style="font-size: 2em; margin: 20px;">‚è≥</div>
      </div>
    </div>

    <!-- –≠—Ç–∞–ø 5: –£–≥–∞–¥—ã–≤–∞–Ω–∏–µ -->
    <div id="step-guessing" class="step hidden">
      <h2>–£–≥–∞–¥–∞–π, —á–µ–π —ç—Ç–æ —Ñ–∞–∫—Ç</h2>
      <div id="progress-display" class="center"></div>
      
      <div class="fact-display" id="current-fact"></div>
      
      <div class="guess-grid" id="players-guess-grid"></div>
      
      <div class="center">
        <button id="submit-guess-btn" class="primary-btn" disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      </div>
    </div>

    <!-- –≠—Ç–∞–ø 6: –û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div id="step-waiting-results" class="step hidden">
      <h2>–û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
      <div class="status">–í—Å–µ —É–≥–∞–¥—ã–≤–∞—é—Ç...</div>
      <div class="center">
        <div style="font-size: 2em; margin: 20px;">ü§î</div>
      </div>
    </div>

    <!-- –≠—Ç–∞–ø 7: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div id="step-results" class="step hidden">
      <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
      <div id="round-results"></div>
      
      <div class="center">
        <button id="next-round-btn" class="primary-btn">–°–ª–µ–¥—É—é—â–∏–π —Ñ–∞–∫—Ç</button>
        <button id="finish-game-btn">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É</button>
      </div>
    </div>

    <!-- –≠—Ç–∞–ø 8: –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div id="step-final-results" class="step hidden">
      <h2>–ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
      <div id="final-results"></div>
      
      <div class="center">
        <button id="new-game-btn" class="primary-btn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
      </div>
    </div>
  </div>

  <script>
    // --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ---
    const ZODIAC_AVATARS = ['‚ôà', '‚ôâ', '‚ôä', '‚ôã', '‚ôå', '‚ôç', '‚ôé', '‚ôè', '‚ôê', '‚ôë', '‚ôí', '‚ôì'];
    const ZODIAC_COLORS = [
      '#fbbf24', '#60a5fa', '#f472b6', '#34d399', '#a78bfa', '#f87171', 
      '#38bdf8', '#facc15', '#a3e635', '#f59e42', '#818cf8', '#f43f5e'
    ];

    // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ ---
    let socket;
    let playerId;
    let roomId;
    let isHost = false;
    let selectedAvatar = '';
    let currentGuess = null;
    let gameState = {
      players: [],
      facts: [],
      currentFactIndex: 0,
      theme: '',
      phase: 'lobby', // lobby, setup, guessing, results
      guesses: {},
      roundResults: []
    };

    // --- DOM —ç–ª–µ–º–µ–Ω—Ç—ã ---
    const steps = {
      join: document.getElementById('step-join'),
      name: document.getElementById('step-name'),
      lobby: document.getElementById('step-lobby'),
      setup: document.getElementById('step-setup'),
      waiting: document.getElementById('step-waiting'),
      guessing: document.getElementById('step-guessing'),
      waitingResults: document.getElementById('step-waiting-results'),
      results: document.getElementById('step-results'),
      finalResults: document.getElementById('step-final-results')
    };

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
    function init() {
      // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π URL)
      socket = io('http://localhost:3000');
      
      setupEventListeners();
      setupSocketListeners();
      showStep('join');
    }

    // --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π ---
    function setupEventListeners() {
      // –ö–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞
      document.getElementById('create-game-btn').onclick = () => {
        isHost = true;
        showStep('name');
        document.getElementById('name-title').textContent = '–°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã';
      };
      
      document.getElementById('join-game-btn').onclick = () => {
        isHost = false;
        const code = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:');
        if (code) {
          roomId = code.toUpperCase();
          showStep('name');
          document.getElementById('name-title').textContent = '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∏–≥—Ä–µ';
        }
      };

      // –í–≤–æ–¥ –∏–º–µ–Ω–∏
      document.getElementById('player-name').oninput = validateName;
      document.getElementById('confirm-name-btn').onclick = joinGame;
      
      // –õ–æ–±–±–∏
      document.getElementById('start-game-btn').onclick = startGame;
      document.getElementById('copy-link-btn').onclick = copyLink;
      
      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–¥–ª—è –≤–µ–¥—É—â–µ–≥–æ)
      document.getElementById('theme-select').onchange = validateSetup;
      document.getElementById('add-fact-btn').onclick = addFactInput;
      document.getElementById('start-round-btn').onclick = startRound;
      
      // –ò–≥—Ä–∞
      document.getElementById('submit-guess-btn').onclick = submitGuess;
      document.getElementById('next-round-btn').onclick = nextRound;
      document.getElementById('finish-game-btn').onclick = finishGame;
      document.getElementById('new-game-btn').onclick = newGame;
    }

    // --- Socket —Å–æ–±—ã—Ç–∏—è ---
    function setupSocketListeners() {
      socket.on('connect', () => {
        console.log('Connected to server');
      });

      socket.on('gameState', (state) => {
        gameState = state;
        updateUI();
      });

      socket.on('playerJoined', (player) => {
        console.log('Player joined:', player);
      });

      socket.on('playerLeft', (playerId) => {
        console.log('Player left:', playerId);
      });

      socket.on('gameStarted', () => {
        if (isHost) {
          showStep('setup');
        } else {
          showStep('waiting');
        }
      });

      socket.on('roundStarted', (fact) => {
        showStep('guessing');
        document.getElementById('current-fact').textContent = fact;
      });

      socket.on('allGuessed', () => {
        showStep('waitingResults');
      });

      socket.on('roundResults', (results) => {
        showStep('results');
        displayRoundResults(results);
      });

      socket.on('gameFinished', (finalResults) => {
        showStep('finalResults');
        displayFinalResults(finalResults);
      });
    }

    // --- UI —Ñ—É–Ω–∫—Ü–∏–∏ ---
    function showStep(stepName) {
      Object.values(steps).forEach(step => step.classList.add('hidden'));
      steps[stepName].classList.remove('hidden');
    }

    function renderAvatarChoices() {
      const container = document.getElementById('avatar-choices');
      container.innerHTML = '';
      
      ZODIAC_AVATARS.forEach((emoji, index) => {
        const div = document.createElement('div');
        div.className = `avatar-choice${selectedAvatar === emoji ? ' selected' : ''}`;
        div.innerHTML = `<div class="avatar" style="background: ${ZODIAC_COLORS[index]}">${emoji}</div>`;
        div.onclick = () => {
          selectedAvatar = emoji;
          renderAvatarChoices();
          validateName();
        };
        container.appendChild(div);
      });
    }

    function validateName() {
      const name = document.getElementById('player-name').value.trim();
      const btn = document.getElementById('confirm-name-btn');
      btn.disabled = !name || !selectedAvatar;
    }

    function joinGame() {
      const name = document.getElementById('player-name').value.trim();
      
      if (!roomId) {
        // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É
        roomId = generateRoomCode();
      }
      
      playerId = generatePlayerId();
      
      socket.emit('joinGame', {
        roomId,
        playerId,
        name,
        avatar: selectedAvatar,
        isHost
      });
      
      showStep('lobby');
      updateLobby();
    }

    function updateLobby() {
      document.getElementById('room-code-display').textContent = roomId;
      document.getElementById('lobby-status').textContent = 
        `–ò–≥—Ä–æ–∫–æ–≤: ${gameState.players.length}`;
      
      const playersList = document.getElementById('players-list');
      playersList.innerHTML = '';
      
      gameState.players.forEach(player => {
        const div = document.createElement('div');
        div.className = 'player-item';
        div.innerHTML = `
          <div class="avatar" style="background: ${getAvatarColor(player.avatar)}">${player.avatar}</div>
          <span>${player.name}</span>
          ${player.isHost ? '<span class="host-badge">–í–µ–¥—É—â–∏–π</span>' : ''}
        `;
        playersList.appendChild(div);
      });
      
      // –¢–æ–ª—å–∫–æ –≤–µ–¥—É—â–∏–π –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É
      const startBtn = document.getElementById('start-game-btn');
      startBtn.disabled = !isHost || gameState.players.length < 2;
    }

    function startGame() {
      socket.emit('startGame', { roomId });
    }

    function copyLink() {
      const link = `${window.location.origin}?room=${roomId}`;
      navigator.clipboard.writeText(link);
      alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
    }

    function addFactInput() {
      const factsList = document.getElementById('facts-list');
      const div = document.createElement('div');
      div.style.marginBottom = '8px';
      div.innerHTML = `
        <input type="text" class="fact-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–∫—Ç" style="margin-bottom: 0;">
        <button type="button" onclick="this.parentElement.remove()" style="margin-left: 8px;">–£–¥–∞–ª–∏—Ç—å</button>
      `;
      factsList.appendChild(div);
      validateSetup();
    }

    function validateSetup() {
      const theme = document.getElementById('theme-select').value;
      const facts = Array.from(document.querySelectorAll('.fact-input')).map(input => input.value.trim()).filter(f => f);
      const btn = document.getElementById('start-round-btn');
      btn.disabled = !theme || facts.length === 0;
    }

    function startRound() {
      const theme = document.getElementById('theme-select').value;
      const facts = Array.from(document.querySelectorAll('.fact-input')).map(input => input.value.trim()).filter(f => f);
      
      socket.emit('startRound', {
        roomId,
        theme,
        facts
      });
    }

    function updateGuessingUI() {
      const progress = document.getElementById('progress-display');
      const fact = document.getElementById('current-fact');
      const grid = document.getElementById('players-guess-grid');
      
      progress.textContent = `–§–∞–∫—Ç ${gameState.currentFactIndex + 1} –∏–∑ ${gameState.facts.length}`;
      fact.textContent = gameState.facts[gameState.currentFactIndex];
      
      grid.innerHTML = '';
      gameState.players.forEach((player, index) => {
        const btn = document.createElement('button');
        btn.className = `guess-btn${currentGuess === index ? ' selected' : ''}`;
        btn.textContent = player.name;
        btn.onclick = () => {
          currentGuess = index;
          updateGuessingUI();
          document.getElementById('submit-guess-btn').disabled = false;
        };
        grid.appendChild(btn);
      });
    }

    function submitGuess() {
      if (currentGuess !== null) {
        socket.emit('submitGuess', {
          roomId,
          playerId,
          guess: currentGuess
        });
        showStep('waitingResults');
      }
    }

    function displayRoundResults(results) {
      const container = document.getElementById('round-results');
      container.innerHTML = `
        <div class="fact-display">${results.fact}</div>
        <p><strong>–ê–≤—Ç–æ—Ä:</strong> ${results.author}</p>
        <p><strong>–ü—Ä–∞–≤–∏–ª—å–Ω–æ —É–≥–∞–¥–∞–ª–∏:</strong> ${results.correct.length}</p>
        <p><strong>–û—à–∏–±–ª–∏—Å—å:</strong> ${results.wrong.length}</p>
      `;
    }

    function displayFinalResults(results) {
      const container = document.getElementById('final-results');
      let html = '<h3>üèÜ –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>';
      
      results.forEach((player, index) => {
        const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
        html += `
          <div class="player-item">
            <div class="avatar" style="background: ${getAvatarColor(player.avatar)}">${player.avatar}</div>
            <span>${player.name} ‚Äî ${player.score} –æ—á–∫–æ–≤ ${medal}</span>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    function nextRound() {
      socket.emit('nextRound', { roomId });
    }

    function finishGame() {
      socket.emit('finishGame', { roomId });
    }

    function newGame() {
      window.location.reload();
    }

    function updateUI() {
      switch (gameState.phase) {
        case 'lobby':
          updateLobby();
          break;
        case 'guessing':
          updateGuessingUI();
          break;
      }
    }

    // --- –£—Ç–∏–ª–∏—Ç—ã ---
    function generateRoomCode() {
      return Math.random().toString(36).substring(2, 8).toUpperCase();
    }

    function generatePlayerId() {
      return Math.random().toString(36).substring(2, 15);
    }

    function getAvatarColor(avatar) {
      const index = ZODIAC_AVATARS.indexOf(avatar);
      return index >= 0 ? ZODIAC_COLORS[index] : '#e5e7eb';
    }

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
    renderAvatarChoices();
    init();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∫–æ–º–Ω–∞—Ç–µ
    const urlParams = new URLSearchParams(window.location.search);
    const roomParam = urlParams.get('room');
    if (roomParam) {
      roomId = roomParam.toUpperCase();
      isHost = false;
      showStep('name');
      document.getElementById('name-title').textContent = '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∏–≥—Ä–µ';
    }
  </script>
</body>
</html> 